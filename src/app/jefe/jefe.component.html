<div class="jefe-dashboard">
  <!-- Header -->
  <header class="header">
    <div class="header-container">
      <div class="header-left">
        <div class="logo-section">
          <div class="logo-circle">
            <img src="assets/logo.png" alt="Logo" class="logo-img" />
          </div>
          <h1>ForestTrack Colombia - Jefe de Brigada</h1>
        </div>
      </div>
      <div class="header-right">
        <span class="user-role">Jefe de Brigada</span>
        <button class="logout-btn" (click)="logout()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
            <polyline points="16,17 21,12 16,7" />
            <line x1="21" y1="12" x2="9" y2="12" />
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="container">
      <!-- Título y botón crear -->
      <div class="section-header">
        <h2>CONGLOMERADOS</h2>
        <button class="btn btn-primary" (click)="abrirCrear()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" />
          </svg>
          Crear Conglomerado
        </button>
      </div>

      <!-- Filtros por estado -->
      <div class="status-tabs">
        <button
          class="status-tab"
          [class.active]="currentFilter === 'pendientes'"
          (click)="filterConglomerados('pendientes')"
        >
          PENDIENTES
        </button>
        <button
          class="status-tab"
          [class.active]="currentFilter === 'aprobados'"
          (click)="filterConglomerados('aprobados')"
        >
          APROBADOS
        </button>
        <button
          class="status-tab"
          [class.active]="currentFilter === 'rechazados'"
          (click)="filterConglomerados('rechazados')"
        >
          RECHAZADOS
        </button>
      </div>

      <!-- Lista de conglomerados -->
      <div class="conglomerados-grid">
        <div class="empty-state" *ngIf="conglomeradosFiltrados.length === 0">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="48"
            height="48"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="empty-icon"
          >
            <line x1="8" y1="6" x2="21" y2="6" />
            <line x1="8" y1="12" x2="21" y2="12" />
            <line x1="8" y1="18" x2="21" y2="18" />
            <line x1="3" y1="6" x2="3.01" y2="6" />
            <line x1="3" y1="12" x2="3.01" y2="12" />
            <line x1="3" y1="18" x2="3.01" y2="18" />
          </svg>
          <p>No hay conglomerados {{ currentFilter }}</p>
        </div>

        <div
          class="conglomerado-card"
          *ngFor="let conglomerado of conglomeradosFiltrados"
        >
          <div class="card-header">
            <h3>{{ conglomerado.id }}</h3>
            <div class="badge" [ngClass]="'badge-' + conglomerado.estado">
              {{ conglomerado.estado.toUpperCase() }}
            </div>
          </div>
          <div class="card-content">
            <p>
              <strong>Departamento:</strong> {{ conglomerado.departamento }}
            </p>
            <p><strong>Municipio:</strong> {{ conglomerado.municipio }}</p>
            <p>
              <strong>Coordenadas:</strong>
              {{ conglomerado.coordenadas_centro }}
            </p>
            <p>
              <strong>Fecha Inicio:</strong> {{ conglomerado.fecha_inicio }}
            </p>
            <p>
              <strong>Fecha Fin:</strong> {{ conglomerado.fecha_finalizacion }}
            </p>
          </div>
          <div
            class="card-actions"
            *ngIf="conglomerado.estado === 'pendientes'"
          >
            <button
              class="btn btn-success btn-sm"
              (click)="aprobarConglomerado(conglomerado.id)"
            >
              Aprobar
            </button>
            <button
              class="btn btn-destructive btn-sm"
              (click)="rechazarConglomerado(conglomerado.id)"
            >
              Rechazar
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Modal Crear Conglomerado -->
  <div class="modal" *ngIf="modalCrearOpen" style="display: flex">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Crear Nuevo Conglomerado</h3>
        <button class="modal-close" (click)="cerrarModalCrear()">
          &times;
        </button>
      </div>
      <div class="modal-body">
        <form
          [formGroup]="conglomeradoForm"
          (ngSubmit)="onSubmitConglomerado()"
        >
          <div class="form-row">
            <div class="form-group">
              <label for="departamento">Departamento</label>
              <input
                type="text"
                id="departamento"
                formControlName="departamento"
                class="form-input"
                required
              />
            </div>
            <div class="form-group">
              <label for="municipio">Municipio</label>
              <input
                type="text"
                id="municipio"
                formControlName="municipio"
                class="form-input"
                required
              />
            </div>
          </div>

          <div class="form-group">
            <label for="corregimiento">Corregimiento</label>
            <input
              type="text"
              id="corregimiento"
              formControlName="corregimiento"
              class="form-input"
            />
          </div>

          <div class="form-group">
            <label for="coordenadas">Coordenadas Centro</label>
            <input
              type="text"
              id="coordenadas"
              name="coordenadas"
              placeholder="Ej: 04°32'15.67&quot;N 74°12'45.89&quot;W"
              required
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="fechaInicio">Fecha de Inicio</label>
              <input
                type="date"
                id="fechaInicio"
                formControlName="fechaInicio"
                class="form-input"
                required
              />
            </div>
            <div class="form-group">
              <label for="fechaFin">Fecha de Finalización</label>
              <input
                type="date"
                id="fechaFin"
                formControlName="fechaFin"
                class="form-input"
                required
              />
            </div>
          </div>

          <div class="form-group">
            <label for="precision">Precisión GPS</label>
            <input
              type="text"
              id="precision"
              formControlName="precision"
              class="form-input"
              placeholder="Ej: ±0.35 m"
              required
            />
          </div>

          <h4>Punto de Referencia</h4>
          <div class="form-row">
            <div class="form-group">
              <label for="puntoTipo">Tipo</label>
              <input
                type="text"
                id="puntoTipo"
                formControlName="puntoTipo"
                class="form-input"
                placeholder="Ej: Árbol destacado"
              />
            </div>
            <div class="form-group">
              <label for="puntoAzimut">Azimut</label>
              <input
                type="text"
                id="puntoAzimut"
                formControlName="puntoAzimut"
                class="form-input"
                placeholder="Ej: 45°"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="puntoDistancia">Distancia horizontal</label>
            <input
              type="text"
              id="puntoDistancia"
              formControlName="puntoDistancia"
              class="form-input"
              placeholder="Ej: 15 m"
            />
          </div>

          <div class="form-actions">
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="!conglomeradoForm.valid"
            >
              Guardar
            </button>
            <button
              type="button"
              class="btn btn-secondary"
              (click)="cerrarModalCrear()"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
